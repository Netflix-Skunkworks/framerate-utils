{"version":3,"file":"framerate-utils.cjs.production.min.js","sources":["../src/utils/string.ts","../src/index.ts"],"sourcesContent":["export function pad(n: number) {\n  if (n < 10) {\n    return `0${n.toString(10)}`;\n  } else {\n    return n.toString(10);\n  }\n}\n\nexport function padMs(n: number) {\n  if (n < 10) {\n    return `00${n.toString(10)}`;\n  } else if (n < 100) {\n    return `0${n.toString(10)}`;\n  } else {\n    return n.toString(10);\n  }\n}\n","import { pad, padMs } from './utils/string';\n\nconst { round, ceil, floor, max } = Math;\n\nexport const SECONDS_PER_HOUR = 60 * 60;\nexport const SECONDS_PER_MINUTE = 60;\nexport const MILLISECONDS_PER_SECOND = 1000;\nexport const TICKS_PER_SECOND = 10000000;\n\nexport const RATE_23_976 = create(24, 1000, 1001);\nexport const RATE_24 = create(24, 1, 1);\nexport const RATE_25 = create(25, 1, 1);\nexport const RATE_29_97 = create(30, 1000, 1001);\nexport const RATE_29_97_DROP = create(30, 1000, 1001, true);\nexport const RATE_30 = create(30, 1, 1);\nexport const RATE_48 = create(48, 1, 1);\nexport const RATE_50 = create(50, 1, 1);\nexport const RATE_59_94 = create(60, 1000, 1001);\nexport const RATE_59_94_DROP = create(60, 1000, 1001, true);\nexport const RATE_60 = create(60, 1, 1);\n\nexport const DEFAULT_FRAME_RATE = RATE_23_976;\n\n/*\n * Adjustment required to account for rounding of input data.\n * For example:\n * frame 836 @ 24fps = 34.83333333333333s\n * This can be rounded by input format to 34833ms\n * 34833ms @ 24fps is frame 835.992 which will be treated as frame 835.\n * To adjust for this 0.001s will be added before truncating.\n *\n * Update: Rounding with CAP files can cause up to 2ms difference, so update\n * rounding to up to 2ms.\n */\nexport const FRAME_ROUNDING = 0.002;\n\nexport interface FrameRate {\n  rate: number;\n  numerator: number;\n  denominator: number;\n  fps: number;\n  dropFrame: boolean;\n}\n\nexport function create(\n  rate = 24,\n  numerator = 1,\n  denominator = 1,\n  dropFrame = false\n): FrameRate {\n  return {\n    rate,\n    numerator,\n    denominator,\n    fps: (rate * numerator) / denominator,\n    dropFrame,\n  };\n}\n\nexport function secondsToSmpte(frameRate: FrameRate, seconds: number) {\n  return frameToSmpte(frameRate, secondsToFrame(frameRate, seconds));\n}\n\nexport function smpteToSeconds(frameRate: FrameRate, smpte: string) {\n  return frameToSeconds(frameRate, smpteToFrame(frameRate, smpte));\n}\n\nexport function smpteToMs(frameRate: FrameRate, smpte: string) {\n  return ceil(smpteToSeconds(frameRate, smpte) * MILLISECONDS_PER_SECOND);\n}\n\nexport function msToSmpte(frameRate: FrameRate, ms: number) {\n  return secondsToSmpte(frameRate, ms / MILLISECONDS_PER_SECOND);\n}\n\nexport function smpteToTicks(frameRate: FrameRate, smpte: string) {\n  return ceil(smpteToSeconds(frameRate, smpte) * TICKS_PER_SECOND);\n}\n\nexport function ticksToSmpte(frameRate: FrameRate, ticks: number) {\n  return secondsToSmpte(frameRate, ticks / TICKS_PER_SECOND);\n}\n\nexport function secondsToFrame(frameRate: FrameRate, seconds: number) {\n  const frame = seconds * frameRate.fps + FRAME_ROUNDING * frameRate.fps;\n  return floor(frame);\n}\n\nexport function msToFrame(frameRate: FrameRate, ms: number) {\n  return secondsToFrame(frameRate, ms / MILLISECONDS_PER_SECOND);\n}\n\nexport function frameToMs(frameRate: FrameRate, frame: number) {\n  return ceil(frameToSeconds(frameRate, frame) * MILLISECONDS_PER_SECOND);\n}\n\nexport function ticksToFrame(frameRate: FrameRate, ticks: number) {\n  return secondsToFrame(frameRate, ticks / TICKS_PER_SECOND);\n}\n\nexport function frameToTicks(frameRate: FrameRate, frame: number) {\n  return ceil(frameToSeconds(frameRate, frame) * TICKS_PER_SECOND);\n}\n\nexport function frameToSmpte(frameRate: FrameRate, frame: number) {\n  const extra = extraFrames(frameRate, frame);\n  const seconds = (frame + extra) / frameRate.rate;\n  const f = round((seconds - floor(seconds)) * frameRate.rate);\n  const h = floor(seconds / SECONDS_PER_HOUR);\n  const m = floor((seconds % SECONDS_PER_HOUR) / SECONDS_PER_MINUTE);\n  const s = floor(seconds % SECONDS_PER_MINUTE);\n  const frameSeparator = frameRate.dropFrame ? ';' : ':';\n\n  return `${pad(h)}:${pad(m)}:${pad(s)}${frameSeparator}${pad(f)}`;\n}\n\nfunction div(dividend: number, divisor: number) {\n  return Math.floor(dividend / divisor);\n}\n\n/**\n * Return the number of extra frames required to convert drop frame to\n * SMPTE timecode.\n * Based on calculation from http://andrewduncan.net/timecodes/\n *          D = frameNumber div 17982\n *          M = frameNumber mod 17982\n *          frameNumber +=  18*D + 2*((M - 2) div 1798)\n * See also https://video.stackexchange.com/questions/22722/how-are-frames-in-59-94-drop-frame-timecode-dropped/22724#22724\n * for support for 59.94fps\n *\n * @param {FrameRate} frameRate The frame rate to use for conversion\n * @param {Number} frame The actual number of frames\n * @returns {Number} The extra frames required\n */\nexport function extraFrames(frameRate: FrameRate, frame: number) {\n  if (!frameRate.dropFrame) {\n    return 0;\n  }\n\n  let framesPer10Mins = 17982;\n  let dropFrames = 2;\n\n  if (frameRate.rate === 60) {\n    framesPer10Mins = 35964;\n    dropFrames = 4;\n  }\n\n  const D = div(frame, framesPer10Mins);\n  let M = frame % framesPer10Mins;\n  if (M < dropFrames) {\n    // Special case for M=0 and M=1: -2 div 1798 should be 0\n    M = dropFrames;\n  }\n\n  return max(\n    0,\n    9 * dropFrames * D +\n      dropFrames * div(M - dropFrames, div(framesPer10Mins, 10))\n  );\n}\n\n// Return the number of frames to subtract to convert smpte drop frame\n// back to frame number.\n// http://andrewduncan.net/timecodes/\n// totalMinutes = 60 * hours + minutes\n// frameNumber  = 108000 * hours + 1800 * minutes\n//                  + 30 * seconds + frames\n//                   - 2 * (totalMinutes - totalMinutes div 10)\nexport function subtractFrames(frameRate: FrameRate, h: number, m: number) {\n  if (!frameRate.dropFrame) {\n    return 0;\n  }\n\n  let dropFrames = 2;\n\n  if (frameRate.rate === 60) {\n    dropFrames = 4;\n  }\n\n  const totalMinutes = h * 60 + m;\n\n  return dropFrames * (totalMinutes - div(totalMinutes, 10));\n}\n\nexport function smpteToFrame(frameRate: FrameRate, smpte: string) {\n  const parts = smpte.split(/:|;/);\n  let h, m, s, f;\n\n  if (parts.length === 3) {\n    h = 0;\n    m = parseInt(parts[0]);\n    s = parseInt(parts[1]);\n    f = parseInt(parts[2]);\n  } else if (parts.length === 4) {\n    h = parseInt(parts[0]);\n    m = parseInt(parts[1]);\n    s = parseInt(parts[2]);\n    f = parseInt(parts[3]);\n  } else {\n    return 0;\n  }\n\n  const seconds = h * SECONDS_PER_HOUR + m * SECONDS_PER_MINUTE + s;\n  const frames = seconds * frameRate.rate + f;\n\n  return frames - subtractFrames(frameRate, h, m);\n}\n\nexport function frameToSeconds(frameRate: FrameRate, frame: number) {\n  return frame / frameRate.fps;\n}\n\nexport function seekByFrames(\n  frameRate: FrameRate,\n  fromTimeSeconds: number,\n  frameDelta: number\n) {\n  const frame = secondsToFrame(frameRate, fromTimeSeconds);\n  return seekToFrame(frameRate, frame + frameDelta);\n}\n\nexport function seekToFrame(frameRate: FrameRate, frame: number) {\n  const newTime = frameToSeconds(frameRate, frame);\n  const halfFrame = frameToSeconds(frameRate, 1) / 2;\n\n  // add half frame to ensure the resulting time is in the frame\n  return newTime + halfFrame;\n}\n\nexport function toFrameTime(frameRate: FrameRate, seconds: number) {\n  return seekByFrames(frameRate, seconds, 0);\n}\n\nexport function mediaToSeconds(media: string) {\n  const parts = media.split(/:|\\.|,/);\n  let h, m, s, ms;\n\n  if (parts.length === 4) {\n    h = parseInt(parts[0]);\n    m = parseInt(parts[1]);\n    s = parseInt(parts[2]);\n    ms = parseInt(parts[3]);\n  } else {\n    return 0;\n  }\n\n  var seconds = h * SECONDS_PER_HOUR + m * SECONDS_PER_MINUTE + s;\n  return seconds + ms / 1000;\n}\n\nexport function secondsToMedia(seconds: number) {\n  var sec = floor(seconds);\n  var ms = round((seconds - sec) * MILLISECONDS_PER_SECOND);\n  var h = floor(sec / SECONDS_PER_HOUR);\n  var m = floor((sec % SECONDS_PER_HOUR) / SECONDS_PER_MINUTE);\n  var s = floor(sec % SECONDS_PER_MINUTE);\n\n  return pad(h) + ':' + pad(m) + ':' + pad(s) + '.' + padMs(ms);\n}\n\nexport function mediaFramesToSeconds(fr: FrameRate, media: string) {\n  var parts = media.split(/:/);\n  let h, m, s, f;\n\n  if (parts.length === 4) {\n    h = parseInt(parts[0]);\n    m = parseInt(parts[1]);\n    s = parseInt(parts[2]);\n    f = parseInt(parts[3]);\n  } else {\n    return 0;\n  }\n\n  var seconds = h * SECONDS_PER_HOUR + m * SECONDS_PER_MINUTE + s;\n  return seconds + f / fr.fps;\n}\n\nexport function secondsToMediaFrames(fr: FrameRate, seconds: number) {\n  var sec = floor(seconds);\n  var f = round((seconds - sec) * fr.fps);\n  var h = floor(sec / SECONDS_PER_HOUR);\n  var m = floor((sec % SECONDS_PER_HOUR) / SECONDS_PER_MINUTE);\n  var s = floor(sec % SECONDS_PER_MINUTE);\n\n  return pad(h) + ':' + pad(m) + ':' + pad(s) + ':' + pad(f);\n}\n\nexport function ticksToSeconds(ticks: number) {\n  return ticks / TICKS_PER_SECOND;\n}\n\nexport function secondsToTicks(seconds: number) {\n  return floor(seconds * TICKS_PER_SECOND);\n}\n\nexport function msToSeconds(ms: number) {\n  return ms / MILLISECONDS_PER_SECOND;\n}\n\nexport function secondsToMs(seconds: number) {\n  return seconds * MILLISECONDS_PER_SECOND;\n}\n\nexport function fromTag(tag: string) {\n  switch (tag) {\n    case 'FPS_2397':\n      return RATE_23_976;\n    case 'FPS_24':\n      return RATE_24;\n    case 'FPS_2400':\n      return RATE_24;\n    case 'FPS_25':\n      return RATE_25;\n    case 'FPS_2500':\n      return RATE_25;\n    case 'FPS_2997':\n      return RATE_29_97_DROP;\n    case 'FPS_30':\n      return RATE_30;\n    case 'FPS_3000':\n      return RATE_30;\n    case 'FPS_4800':\n      return RATE_48;\n    case 'FPS_50':\n      return RATE_50;\n    case 'FPS_5000':\n      return RATE_50;\n    case 'FPS_5994':\n      return RATE_59_94_DROP;\n    case 'FPS_60':\n      return RATE_60;\n    case 'FPS_6000':\n      return RATE_60;\n    default:\n      throw new TypeError(`Unknown Frame Rate ${tag}`);\n  }\n}\n"],"names":["pad","n","toString","round","Math","ceil","floor","max","RATE_23_976","create","RATE_24","RATE_25","RATE_29_97","RATE_29_97_DROP","RATE_30","RATE_48","RATE_50","RATE_59_94","RATE_59_94_DROP","RATE_60","rate","numerator","denominator","dropFrame","fps","secondsToSmpte","frameRate","seconds","frameToSmpte","secondsToFrame","smpteToSeconds","smpte","frameToSeconds","smpteToFrame","frame","extraFrames","f","h","m","s","frameSeparator","div","dividend","divisor","framesPer10Mins","dropFrames","D","M","subtractFrames","totalMinutes","parts","split","length","parseInt","seekByFrames","fromTimeSeconds","frameDelta","seekToFrame","tag","TypeError","fr","media","ms","sec","ticks"],"mappings":"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"}